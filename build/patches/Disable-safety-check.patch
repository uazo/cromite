From: csagan5 <32685696+csagan5@users.noreply.github.com>
Date: Sun, 6 Mar 2022 17:39:15 +0100
Subject: Disable safety check

License: GPL-3.0-only - https://spdx.org/licenses/GPL-3.0-only.html
---
 chrome/android/BUILD.gn                       |  5 ----
 chrome/android/chrome_java_sources.gni        |  1 -
 .../android/java/res/xml/main_preferences.xml |  2 +-
 .../PasswordCheckupLauncher.java              | 25 ----------------
 .../settings/FragmentDependencyProvider.java  | 29 -------------------
 .../chrome/browser/settings/MainSettings.java |  2 +-
 .../settings/SettingsNavigationImpl.java      |  3 +-
 .../search/SearchIndexProviderRegistry.java   |  2 --
 chrome/browser/BUILD.gn                       |  1 -
 chrome/browser/safety_check/android/BUILD.gn  |  2 --
 .../safety_check/SafetyCheckBridge.java       |  4 +--
 .../suggestions/action/OmniboxPedal.java      |  3 --
 .../Disable-safety-check.inc                  |  1 +
 13 files changed, 6 insertions(+), 74 deletions(-)
 create mode 100644 cromite_flags/chrome/common/chrome_features_cc/Disable-safety-check.inc

diff --git a/chrome/android/BUILD.gn b/chrome/android/BUILD.gn
--- a/chrome/android/BUILD.gn
+++ b/chrome/android/BUILD.gn
@@ -445,7 +445,6 @@ if (_is_default_toolchain) {
       "//chrome/browser/recent_tabs:java",
       "//chrome/browser/regional_capabilities/android:java",
       "//chrome/browser/safe_browsing/android:java",
-      "//chrome/browser/safety_check/android:java",
       "//chrome/browser/safety_hub/android:java",
       "//chrome/browser/screenshot_monitor:java",
       "//chrome/browser/search_engines/android:java",
@@ -1129,8 +1128,6 @@ if (_is_default_toolchain) {
       "//chrome/browser/recent_tabs:junit",
       "//chrome/browser/recent_tabs/internal:junit",
       "//chrome/browser/safe_browsing/android:junit",
-      "//chrome/browser/safety_check/android:junit",
-      "//chrome/browser/safety_hub/android:junit",
       "//chrome/browser/search_engines/android:junit",
       "//chrome/browser/search_resumption:junit",
       "//chrome/browser/serial/android:junit",
@@ -1422,8 +1419,6 @@ if (_is_default_toolchain) {
       "//chrome/browser/quick_delete:javatests",
       "//chrome/browser/renderer_host/android:javatests",
       "//chrome/browser/safe_browsing/android:javatests",
-      "//chrome/browser/safety_check/android:javatests",
-      "//chrome/browser/safety_hub/android:javatests",
       "//chrome/browser/segmentation_platform:javatests",
       "//chrome/browser/selection/android:javatests",
       "//chrome/browser/ssl/android:javatests",
diff --git a/chrome/android/chrome_java_sources.gni b/chrome/android/chrome_java_sources.gni
--- a/chrome/android/chrome_java_sources.gni
+++ b/chrome/android/chrome_java_sources.gni
@@ -990,7 +990,6 @@ chrome_java_sources = [
   "java/src/org/chromium/chrome/browser/safe_browsing/SafeBrowsingPasswordReuseDialogBridge.java",
   "java/src/org/chromium/chrome/browser/safe_browsing/SafeBrowsingReferringAppBridge.java",
   "java/src/org/chromium/chrome/browser/safe_browsing/SafeBrowsingSettingsNavigation.java",
-  "java/src/org/chromium/chrome/browser/safety_check/SafetyCheckUpdatesDelegateImpl.java",
   "java/src/org/chromium/chrome/browser/searchwidget/SearchActivity.java",
   "java/src/org/chromium/chrome/browser/searchwidget/SearchActivityClientImpl.java",
   "java/src/org/chromium/chrome/browser/searchwidget/SearchActivityLocationBarLayout.java",
diff --git a/chrome/android/java/res/xml/main_preferences.xml b/chrome/android/java/res/xml/main_preferences.xml
--- a/chrome/android/java/res/xml/main_preferences.xml
+++ b/chrome/android/java/res/xml/main_preferences.xml
@@ -55,7 +55,7 @@ found in the LICENSE file.
         android:fragment="org.chromium.chrome.browser.safety_hub.SafetyHubFragment"
         android:key="safety_hub"
         android:order="10"
-        android:title="@string/prefs_safety_check"/>
+        android:title="@string/prefs_safety_check" app:isPreferenceVisible="false"/>
 
     <PreferenceCategory
         android:key="autofill_section"
diff --git a/chrome/android/java/src/org/chromium/chrome/browser/password_manager/PasswordCheckupLauncher.java b/chrome/android/java/src/org/chromium/chrome/browser/password_manager/PasswordCheckupLauncher.java
--- a/chrome/android/java/src/org/chromium/chrome/browser/password_manager/PasswordCheckupLauncher.java
+++ b/chrome/android/java/src/org/chromium/chrome/browser/password_manager/PasswordCheckupLauncher.java
@@ -8,7 +8,6 @@ import org.jni_zero.CalledByNative;
 import org.chromium.build.annotations.NullMarked;
 import org.chromium.build.annotations.Nullable;
 import org.chromium.chrome.browser.profiles.Profile;
-import org.chromium.chrome.browser.safety_check.SafetyCheckSettingsFragment;
 import org.chromium.chrome.browser.settings.SettingsCustomTabLauncherImpl;
 import org.chromium.chrome.browser.settings.SettingsNavigationFactory;
 import org.chromium.components.browser_ui.settings.SettingsNavigation.SettingsFragment;
@@ -23,37 +22,13 @@ public class PasswordCheckupLauncher {
             WindowAndroid windowAndroid,
             @PasswordCheckReferrer int passwordCheckReferrer,
             @Nullable String accountEmail) {
-        assert accountEmail == null || !accountEmail.isEmpty();
-        if (windowAndroid.getContext().get() == null) return; // Window not available yet/anymore.
-        assert profile != null;
-
-        PasswordManagerHelper passwordManagerHelper = PasswordManagerHelper.getForProfile(profile);
-        // This is invoked from the leak dialog if the compromised password is saved for other
-        // sites. After the login DB deprecation, this code path is guaranteed to only be
-        // executed for users with access to UPM, since they are the only ones with saved
-        // passwords.
-        passwordManagerHelper.showPasswordCheckup(
-                windowAndroid.getContext().get(),
-                passwordCheckReferrer,
-                () -> windowAndroid.getModalDialogManager(),
-                accountEmail,
-                new SettingsCustomTabLauncherImpl());
     }
 
     @CalledByNative
     static void launchSafetyCheck(WindowAndroid windowAndroid) {
-        if (windowAndroid.getContext().get() == null) return; // Window not available yet/anymore.
-        SettingsNavigationFactory.createSettingsNavigation()
-                .startSettings(
-                        windowAndroid.getContext().get(),
-                        SafetyCheckSettingsFragment.class,
-                        SafetyCheckSettingsFragment.createBundle(true));
     }
 
     @CalledByNative
     static void launchSafetyHub(WindowAndroid windowAndroid) {
-        if (windowAndroid.getContext().get() == null) return; // Window not available yet/anymore.
-        SettingsNavigationFactory.createSettingsNavigation()
-                .startSettings(windowAndroid.getContext().get(), SettingsFragment.SAFETY_CHECK);
     }
 }
diff --git a/chrome/android/java/src/org/chromium/chrome/browser/settings/FragmentDependencyProvider.java b/chrome/android/java/src/org/chromium/chrome/browser/settings/FragmentDependencyProvider.java
--- a/chrome/android/java/src/org/chromium/chrome/browser/settings/FragmentDependencyProvider.java
+++ b/chrome/android/java/src/org/chromium/chrome/browser/settings/FragmentDependencyProvider.java
@@ -34,13 +34,6 @@ import org.chromium.chrome.browser.privacy_guide.PrivacyGuideFragment;
 import org.chromium.chrome.browser.privacy_sandbox.PrivacySandboxSettingsBaseFragment;
 import org.chromium.chrome.browser.privacy_sandbox.TopicsManageFragment;
 import org.chromium.chrome.browser.profiles.Profile;
-import org.chromium.chrome.browser.safety_check.SafetyCheckBridge;
-import org.chromium.chrome.browser.safety_check.SafetyCheckCoordinator;
-import org.chromium.chrome.browser.safety_check.SafetyCheckSettingsFragment;
-import org.chromium.chrome.browser.safety_check.SafetyCheckUpdatesDelegateImpl;
-import org.chromium.chrome.browser.safety_hub.SafetyHubBaseFragment;
-import org.chromium.chrome.browser.safety_hub.SafetyHubFragment;
-import org.chromium.chrome.browser.safety_hub.SafetyHubModuleDelegateImpl;
 import org.chromium.chrome.browser.search_engines.settings.SearchEngineSettings;
 import org.chromium.chrome.browser.settings.search.SettingsSearchCoordinator;
 import org.chromium.chrome.browser.signin.SigninAndHistorySyncActivityLauncherImpl;
@@ -137,17 +130,6 @@ public class FragmentDependencyProvider extends FragmentManager.FragmentLifecycl
             delegate.setSnackbarManagerSupplier(mSnackbarManagerSupplier);
             baseSiteSettingsFragment.setSiteSettingsDelegate(delegate);
         }
-        if (fragment instanceof SafetyCheckSettingsFragment) {
-            SafetyCheckCoordinator.create(
-                    (SafetyCheckSettingsFragment) fragment,
-                    new SafetyCheckUpdatesDelegateImpl(),
-                    new SafetyCheckBridge(mProfile),
-                    mModalDialogManagerSupplier,
-                    SyncServiceFactory.getForProfile(mProfile),
-                    new PasswordStoreBridge(mProfile),
-                    PasswordManagerHelper.getForProfile(mProfile),
-                    new SettingsCustomTabLauncherImpl());
-        }
         if (fragment instanceof CredentialEntryFragmentViewBase) {
             CredentialEditUiFactory.create((CredentialEntryFragmentViewBase) fragment, mProfile);
         }
@@ -216,14 +198,6 @@ public class FragmentDependencyProvider extends FragmentManager.FragmentLifecycl
                     .setModalDialogManagerSupplier(
                             (Supplier<@Nullable ModalDialogManager>) mModalDialogManagerSupplier);
         }
-        if (fragment instanceof SafetyHubFragment safetyHubFragment) {
-            safetyHubFragment.setDelegate(
-                    new SafetyHubModuleDelegateImpl(
-                            mProfile,
-                            mModalDialogManagerSupplier.asNonNull(),
-                            SigninAndHistorySyncActivityLauncherImpl.get(),
-                            new SettingsCustomTabLauncherImpl()));
-        }
         if (fragment instanceof INeedSnackbarManager) {
             ((INeedSnackbarManager)fragment).setSnackbarManagerSupplier(mSnackbarManagerSupplier);
         }
@@ -238,8 +212,5 @@ public class FragmentDependencyProvider extends FragmentManager.FragmentLifecycl
         if (fragment instanceof ManageSyncSettings) {
             ((ManageSyncSettings) fragment).setSnackbarManagerSupplier(mSnackbarManagerSupplier);
         }
-        if (fragment instanceof SafetyHubBaseFragment) {
-            ((SafetyHubBaseFragment) fragment).setSnackbarManagerSupplier(mSnackbarManagerSupplier);
-        }
     }
 }
diff --git a/chrome/android/java/src/org/chromium/chrome/browser/settings/MainSettings.java b/chrome/android/java/src/org/chromium/chrome/browser/settings/MainSettings.java
--- a/chrome/android/java/src/org/chromium/chrome/browser/settings/MainSettings.java
+++ b/chrome/android/java/src/org/chromium/chrome/browser/settings/MainSettings.java
@@ -378,7 +378,7 @@ public class MainSettings extends ChromeBaseSettingsFragment
     }
 
     private static boolean shouldShowSafetyHubPref() {
-        return !DeviceInfo.isAutomotive();
+        return false;
     }
 
     private static boolean shouldShowNotificationPref(Context context, Intent intent) {
diff --git a/chrome/android/java/src/org/chromium/chrome/browser/settings/SettingsNavigationImpl.java b/chrome/android/java/src/org/chromium/chrome/browser/settings/SettingsNavigationImpl.java
--- a/chrome/android/java/src/org/chromium/chrome/browser/settings/SettingsNavigationImpl.java
+++ b/chrome/android/java/src/org/chromium/chrome/browser/settings/SettingsNavigationImpl.java
@@ -18,7 +18,6 @@ import org.chromium.chrome.browser.autofill.settings.AutofillPaymentMethodsFragm
 import org.chromium.chrome.browser.autofill.settings.FinancialAccountsManagementFragment;
 import org.chromium.chrome.browser.autofill.settings.NonCardPaymentMethodsManagementFragment;
 import org.chromium.chrome.browser.browsing_data.ClearBrowsingDataFragment;
-import org.chromium.chrome.browser.safety_hub.SafetyHubFragment;
 import org.chromium.chrome.browser.password_manager.settings.PasswordSettings;
 import org.chromium.chrome.browser.sync.settings.GoogleServicesSettings;
 import org.chromium.chrome.browser.sync.settings.ManageSyncSettings;
@@ -153,7 +152,7 @@ public class SettingsNavigationImpl implements SettingsNavigation {
             case SettingsFragment.PAYMENT_METHODS:
                 return AutofillPaymentMethodsFragment.class;
             case SettingsFragment.SAFETY_CHECK:
-                return SafetyHubFragment.class;
+                return null;
             case SettingsFragment.SITE:
                 return SiteSettings.class;
             case SettingsFragment.ACCESSIBILITY:
diff --git a/chrome/android/java/src/org/chromium/chrome/browser/settings/search/SearchIndexProviderRegistry.java b/chrome/android/java/src/org/chromium/chrome/browser/settings/search/SearchIndexProviderRegistry.java
--- a/chrome/android/java/src/org/chromium/chrome/browser/settings/search/SearchIndexProviderRegistry.java
+++ b/chrome/android/java/src/org/chromium/chrome/browser/settings/search/SearchIndexProviderRegistry.java
@@ -123,8 +123,6 @@ public final class SearchIndexProviderRegistry {
                             .SEARCH_INDEX_DATA_PROVIDER,
                     org.chromium.chrome.browser.privacy.settings.PrivacySettings
                             .SEARCH_INDEX_DATA_PROVIDER,
-                    org.chromium.chrome.browser.safety_check.SafetyCheckSettingsFragment
-                            .SEARCH_INDEX_DATA_PROVIDER,
                     org.chromium.chrome.browser.tasks.tab_management.TabsSettings
                             .SEARCH_INDEX_DATA_PROVIDER,
                     org.chromium.chrome.browser.sync.settings.ManageSyncSettings
diff --git a/chrome/browser/BUILD.gn b/chrome/browser/BUILD.gn
--- a/chrome/browser/BUILD.gn
+++ b/chrome/browser/BUILD.gn
@@ -3411,7 +3411,6 @@ static_library("browser") {
       "//chrome/browser/recent_tabs:jni_headers",
       "//chrome/browser/regional_capabilities",
       "//chrome/browser/safe_browsing/android:safe_browsing_enums",
-      "//chrome/browser/safety_check/android",
       "//chrome/browser/safety_hub/android",
       "//chrome/browser/search_resumption:jni_headers",
       "//chrome/browser/serial/android:jni_headers",
diff --git a/chrome/browser/safety_check/android/BUILD.gn b/chrome/browser/safety_check/android/BUILD.gn
--- a/chrome/browser/safety_check/android/BUILD.gn
+++ b/chrome/browser/safety_check/android/BUILD.gn
@@ -14,7 +14,6 @@ generate_jni("jni_headers") {
 source_set("android") {
   sources = [ "safety_check_bridge.cc" ]
   deps = [
-    ":jni_headers",
     "//chrome/browser/signin:identity_manager_provider",
     "//components/password_manager/core/browser/leak_detection",
     "//components/prefs",
@@ -71,7 +70,6 @@ android_library("java") {
 
   srcjar_deps = [
     ":bulk_leak_check_service_enums",
-    ":jni_headers",
     ":safety_check_enums",
   ]
   resources_package = "org.chromium.chrome.browser.safety_check"
diff --git a/chrome/browser/safety_check/android/java/src/org/chromium/chrome/browser/safety_check/SafetyCheckBridge.java b/chrome/browser/safety_check/android/java/src/org/chromium/chrome/browser/safety_check/SafetyCheckBridge.java
--- a/chrome/browser/safety_check/android/java/src/org/chromium/chrome/browser/safety_check/SafetyCheckBridge.java
+++ b/chrome/browser/safety_check/android/java/src/org/chromium/chrome/browser/safety_check/SafetyCheckBridge.java
@@ -23,7 +23,7 @@ public class SafetyCheckBridge {
 
     /** Returns whether the user is signed in for the purposes of password check. */
     boolean userSignedIn() {
-        return SafetyCheckBridgeJni.get().userSignedIn(mProfile);
+        return false;
     }
 
     /**
@@ -34,7 +34,7 @@ public class SafetyCheckBridge {
      */
     @SafeBrowsingStatus
     int checkSafeBrowsing() {
-        return SafetyCheckBridgeJni.get().checkSafeBrowsing(mProfile);
+        return SafeBrowsingStatus.DISABLED;
     }
 
     /** C++ method signatures. */
diff --git a/chrome/browser/ui/android/omnibox/java/src/org/chromium/chrome/browser/omnibox/suggestions/action/OmniboxPedal.java b/chrome/browser/ui/android/omnibox/java/src/org/chromium/chrome/browser/omnibox/suggestions/action/OmniboxPedal.java
--- a/chrome/browser/ui/android/omnibox/java/src/org/chromium/chrome/browser/omnibox/suggestions/action/OmniboxPedal.java
+++ b/chrome/browser/ui/android/omnibox/java/src/org/chromium/chrome/browser/omnibox/suggestions/action/OmniboxPedal.java
@@ -61,9 +61,6 @@ public class OmniboxPedal extends OmniboxAction {
             case OmniboxPedalId.UPDATE_CREDIT_CARD:
                 delegate.openSettingsPage(SettingsFragment.PAYMENT_METHODS);
                 break;
-            case OmniboxPedalId.RUN_CHROME_SAFETY_CHECK:
-                delegate.openSettingsPage(SettingsFragment.SAFETY_CHECK);
-                break;
             case OmniboxPedalId.MANAGE_SITE_SETTINGS:
                 delegate.openSettingsPage(SettingsFragment.SITE);
                 break;
diff --git a/cromite_flags/chrome/common/chrome_features_cc/Disable-safety-check.inc b/cromite_flags/chrome/common/chrome_features_cc/Disable-safety-check.inc
new file mode 100644
--- /dev/null
+++ b/cromite_flags/chrome/common/chrome_features_cc/Disable-safety-check.inc
@@ -0,0 +1 @@
+// intentionally empty
--
