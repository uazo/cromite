From: csagan5 <32685696+csagan5@users.noreply.github.com>
Date: Sat, 19 Mar 2022 10:53:24 +0100
Subject: Dictionary suggestions for the Omnibox

Revert "Disable Dictionary suggestions for the Omnibox"

This reverts commit d3ec2b2d25066ec089f8351a44b919ded4270e83.

Original License: BSD-3-Clause - https://spdx.org/licenses/BSD-3-Clause.html
License: GPL-3.0-only - https://spdx.org/licenses/GPL-3.0-only.html
---
 chrome/android/java/res/layout/url_bar.xml    |  1 +
 .../browser/omnibox/LocationBarMediator.java  | 14 ++++++++---
 .../chrome/browser/omnibox/UrlBar.java        | 24 +++++++++++++++++++
 3 files changed, 36 insertions(+), 3 deletions(-)

diff --git a/chrome/android/java/res/layout/url_bar.xml b/chrome/android/java/res/layout/url_bar.xml
--- a/chrome/android/java/res/layout/url_bar.xml
+++ b/chrome/android/java/res/layout/url_bar.xml
@@ -16,6 +16,7 @@ found in the LICENSE file.
     android:singleLine="true"
     android:imeOptions="actionGo|flagNoExtractUi|flagNoFullscreen"
     android:textAppearance="@style/TextAppearance.SearchBoxText"
+    android:inputType="textUri"
     android:hint="@string/omnibox_empty_hint"
     android:textAlignment="viewStart"
     android:importantForAutofill="no"
diff --git a/chrome/browser/ui/android/omnibox/java/src/org/chromium/chrome/browser/omnibox/LocationBarMediator.java b/chrome/browser/ui/android/omnibox/java/src/org/chromium/chrome/browser/omnibox/LocationBarMediator.java
--- a/chrome/browser/ui/android/omnibox/java/src/org/chromium/chrome/browser/omnibox/LocationBarMediator.java
+++ b/chrome/browser/ui/android/omnibox/java/src/org/chromium/chrome/browser/omnibox/LocationBarMediator.java
@@ -411,8 +411,17 @@ class LocationBarMediator
             if (!mUrlFocusedWithPastedText
                     && !shouldRetainOmniboxOnFocus
                     && mLocationBarLayout.shouldClearTextOnFocus()) {
-                setUrlBarText(
-                        UrlBarData.EMPTY, UrlBar.ScrollType.NO_SCROLL, SelectionState.SELECT_END);
+                UrlBarData data = mLocationBarDataProvider.getUrlBarData();
+                @SelectionState int selectionState = SelectionState.SELECT_ALL;
+                GURL url = mLocationBarDataProvider.getUrlBarData().url;
+                if (url != null && mTemplateUrlServiceSupplier.get() != null) {
+                    String searchParams =
+                        mTemplateUrlServiceSupplier.get().getSearchQueryForUrl(url);
+                    if (searchParams != null && !searchParams.isEmpty()) {
+                        data = UrlBarData.forUrlAndText(data.url, data.displayText, searchParams);
+                    }
+                }
+                setUrlBarText(data, UrlBar.ScrollType.NO_SCROLL, selectionState);
             } else if (shouldRetainOmniboxOnFocus) {
                 mUrlCoordinator.setSelectAllOnFocus(true);
             }
@@ -1921,7 +1930,6 @@ class LocationBarMediator
         mUrlCoordinator.setKeyboardVisibility(true, false);
     }
 
-
     // UrlBarDelegate implementation.
 
     @Override
diff --git a/chrome/browser/ui/android/omnibox/java/src/org/chromium/chrome/browser/omnibox/UrlBar.java b/chrome/browser/ui/android/omnibox/java/src/org/chromium/chrome/browser/omnibox/UrlBar.java
--- a/chrome/browser/ui/android/omnibox/java/src/org/chromium/chrome/browser/omnibox/UrlBar.java
+++ b/chrome/browser/ui/android/omnibox/java/src/org/chromium/chrome/browser/omnibox/UrlBar.java
@@ -11,6 +11,7 @@ import android.graphics.Canvas;
 import android.graphics.Paint;
 import android.graphics.Rect;
 import android.os.Build;
+import android.os.Handler;
 import android.os.SystemClock;
 import android.text.Editable;
 import android.text.InputType;
@@ -112,6 +113,7 @@ public class UrlBar extends AutocompleteEditText {
     private boolean mAllowFocus = true;
     private boolean mShouldSendTypingStartedEvent;
 
+    private boolean mPendingSelectAll;
     private boolean mPendingScroll;
     private boolean mIsInCct;
 
@@ -374,6 +376,28 @@ public class UrlBar extends AutocompleteEditText {
         fixupTextDirection();
 
         mShouldSendTypingStartedEvent = focused;
+
+        if (mPendingSelectAll) {
+            UrlBar sender = this;
+            new Handler().post(new Runnable() {
+                @Override
+                public void run() {
+                    sender.selectAll();
+                    mPendingSelectAll = false;
+                }
+            });
+        }
+    }
+
+    @Override
+    public void selectAll() {
+        mPendingSelectAll = true;
+        super.selectAll();
+    }
+
+    @Override
+    public int getAutofillType() {
+        return AUTOFILL_TYPE_NONE;
     }
 
     @Override
--
